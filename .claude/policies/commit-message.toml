[spec]
name = "Lucent Commits"
objective = "Produce professional, minimal, noise-free commit messages compliant with Conventional Commits."
version = "2.1"
style_name = "Lucent Discipline"

# ----------------------------------------------------------------------
# Modes
# ----------------------------------------------------------------------
[modes.concise]
name = "concise"
alias = "simple"
description = "Default mode for narrowly-scoped, single-domain changes."

[modes.structured]
name = "structured"
alias = "detailed"
description = "Use when changes span multiple domains or require a cross-cutting summary."

# ----------------------------------------------------------------------
# Global hard constraints
# ----------------------------------------------------------------------
[rules.global]
language = "English"
voice = "active"
avoid_filler = true
avoid_hype = true
avoid_subjectivity = true
banned_in_all_sections = [
  "bare URLs (http or https)",
  "ephemeral session or run links",
  "reference-style links ([text](url))",
]

# ----------------------------------------------------------------------
# Subject line rules
# ----------------------------------------------------------------------
[rules.subject_line]
max_length = 50
format = "<type>(<optional_scope>): <subject>"
mood = "imperative"
case = "lowercase"
trailing_punctuation = false

[rules.subject_line.constraints]
require_imperative_verb = true
require_concrete_object = true
ban_vague_subjects = [
  "update stuff",
  "misc changes",
  "minor fixes",
  "small tweaks",
  "cleanup",
  "changes",
]
preferred_phrases = [
  "rename the project to <name>",
  "standardize <thing>",
  "align <thing>",
  "remove <thing>",
  "add <thing>",
  "fix <thing>",
]

# ----------------------------------------------------------------------
# Type rules
# ----------------------------------------------------------------------
[rules.type]
allowed = [
  "feat",
  "fix",
  "perf",
  "refactor",
  "test",
  "build",
  "ci",
  "docs",
  "style",
  "chore",
]

# ----------------------------------------------------------------------
# Scope rules
# ----------------------------------------------------------------------
[rules.scope]
usage = "conditional"
format = "Placed in parentheses immediately after type."
condition_to_use = "Use only for changes confined to one subsystem or directory."
condition_to_omit = """
Omit scope when:
1. Changes span multiple areas/domains.
2. Including scope would exceed the 50-character subject limit.
3. The scope would be vague (e.g., 'misc', 'general', 'all').
Subject clarity and the 50-character constraint take precedence.
"""

# ----------------------------------------------------------------------
# Body rules
# ----------------------------------------------------------------------
[rules.body]
max_line_length = 72
empty_line_after_subject = true
bullet_style = "- "
min_bullets = 1
max_bullets = 5
bullet_terminator = "."
quote_usage = "Avoid quotation marks unless required for exact syntax."
tense = "present"

[rules.body.bullet_rules]
bullet_pattern = "<verb> <target> <reason_or_outcome_optional>"
require_action_verb = true
require_reason_or_outcome = true
ban_colon_labels = true

[rules.body.headered_bullets]
enabled_only_in_mode = "structured"
allowed_headers = ["core", "ui", "test", "build", "ci", "config", "docs", "style"]
format = "- <header>: <verb> <target> <reason/outcome>."
max_bullets = 5

# ----------------------------------------------------------------------
# Breaking change rules
# ----------------------------------------------------------------------
[rules.breaking_change]
usage = "conditional"
decision_rule = "Use only when materially breaking and user-impacting."
subject_syntax = "<type>(<optional_scope>)!: <subject>"
footer_token = "breaking change:"
footer_required = true
footer_max_line_length = 72
url_exception = """
Permitted only in the breaking change footer when citing a stable
public specification or migration guide. Ephemeral URLs are prohibited.
"""

[rules.breaking_change.example]
subject = "feat(api)!: remove legacy v1 auth headers"
body = """
- Remove v1 header parsing to simplify the request pipeline.
- Require oauth bearer tokens to align with the current security model.
"""
footer = """
breaking change: clients must stop sending x-auth-token and migrate to
oauth bearer tokens before upgrading.
"""

# ----------------------------------------------------------------------
# Mode selection gate
# ----------------------------------------------------------------------
[rules.mode_selection]
default_mode = "concise"
domain_markers = [
  "core",
  "ui",
  "test",
  "build",
  "ci",
  "config",
  "docs",
  "style",
]
force_structured_when = """
Select structured mode if ANY apply:
1. Touches 2+ domains.
2. Renames requiring 2+ reference updates.
3. Requires summary beyond bullet text.
"""
force_concise_when = """
Select concise mode ONLY if ALL apply:
1. Touches exactly 1 domain.
2. Explained in 1â€“3 bullets.
3. No cross-file rename or widespread update.
"""

# ----------------------------------------------------------------------
# Output templates
# ----------------------------------------------------------------------
[styles.concise]
mode = "concise"
summary_required = false
structure = [
  "<type>(<optional_scope>): <subject>",
  "",
  "- <verb> <target> <reason/outcome>.",
]
hard_limits = "max 3 bullets. no header labels. no colons. no summary."
example_subject_without_scope = "ci: standardize verification workflow"
example_body = """
- Align workflow triggers to reduce redundant runs.
"""

[styles.structured]
mode = "structured"
summary_required = true
structure = [
  "<type>: <subject>",
  "",
  "<1-2 line summary>",
  "",
  "- <header>: <verb> <target> <reason/outcome>.",
]
hard_limits = "max 5 bullets. headered bullets required."
example_subject = "refactor: rename the project to falling-balls"
example_body = """
Rename code, build, UI, docs, and config to match the new
project name.
- core: rename source files to match binary name.
- build: update include guards and makefile references.
- docs: align documentation with the new project name.
- config: update claude module references.
"""

# ----------------------------------------------------------------------
# Constraints (explicit forbidden patterns)
# ----------------------------------------------------------------------
[rules.constraints]
subject_patterns = [
  "^\\w+\\([^\\)]+\\):\\s*$",
  "^(chore|refactor|docs|ci):\\s*(update|fix)$",
  "\\.$",
  "\\b(wip|tmp|todo)\\b",
  "\\b(misc|various|stuff)\\b",
]
body_patterns = [
  "^-\\s*(note|notes):\\s",
  "^-\\s*\\[[xX]\\]\\s",
  "^-\\s*\\*\\*.*\\*\\*\\s",
  "\\b(hopefully|maybe|just|simply|basically)\\b",
  "https?://\\S+",
]
footer_patterns = [
  "^see[:\\s]",
  "^ref[s]?[:\\s]",
]
scope_values = ["misc", "general", "all", "various", "global"]

[rules.constraints.concise]
body_patterns = [
  "^-\\s*(source|ui|docs|config|core|build|ci|test|style):\\s",
]

# ----------------------------------------------------------------------
# Verification checklist
# ----------------------------------------------------------------------
[verification.checklist]
must_pass = [
  "subject <= 50 characters",
  "subject is lowercase",
  "subject is imperative",
  "blank line after subject",
  "each body line <= 72 characters",
  "bullets use '- ' and end with '.'",
  "no label-style bullets in concise mode",
  "structured mode used when multi-domain",
  "breaking change footer included when '!' is used",
]
